<!DOCTYPE html>
<html lang="en">
<head>
        <title>zfs snapshot blkperl/dev/brain@Today - kvm</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
                <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="zfs snapshot blkperl/dev/brain@Today Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">zfs snapshot blkperl/dev/brain@Today </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="../category/ganeti.html">ganeti</a></li>
                                    <li ><a href="../category/puppet.html">puppet</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../evac-ganeti-node.html">Evacuating a Ganeti node for hardware diagnostics</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2013-03-23T12:00:00">
                Sat 23 March 2013
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/william-van-hevelingen.html">William Van Hevelingen</a>
        </address>
        <p>In <a href="../category/ganeti.html">ganeti</a>. </p>
<p>tags: <a href="../tag/ganeti.html">ganeti</a><a href="../tag/kvm.html">kvm</a></p>
</footer><!-- /.post-info --><p>One of the nodes in our Ganeti cluster was hanging on lvs commands and some of the instances were hanging while they wait for IO. I decided to be proactive and live migrate all of the instances off the node in order to bring it down for some debugging.</p>
<p>The following steps are how I brought the node offline with minimal downtime for production instances.</p>
<h2>Overview of our cluster</h2>
<ul>
<li>4 nodes</li>
<li>46 instances</li>
<li>Ubuntu 12.04 LTS</li>
<li>Ganeti version 2.5.2-1</li>
<li>Kvm version 1.0</li>
</ul>
<h2>Log into the master node</h2>
<p>Log into the master ganeti node.</p>
<div class="codehilite"><pre><span class="n">ssh</span> <span class="n">nebula</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<h2>Migrate the primary instances off suspect node</h2>
<p>Run the gnt-node migrate command, passing in the node to migrate off of</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">node</span> <span class="n">migrate</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<p>The output should look similar to this.</p>
<div class="codehilite"><pre><span class="n">root</span><span class="err">@</span><span class="n">claymore</span><span class="o">:~</span><span class="err">#</span> <span class="n">gnt</span><span class="o">-</span><span class="n">node</span> <span class="n">migrate</span> <span class="n">katana</span>
<span class="n">Migrate</span> <span class="n">instance</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">crystal</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">l1011</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span>
<span class="n">marauder</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">nyan</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">panic</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span>
<span class="n">receptacle</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">ruby</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">sapphire</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span>
<span class="n">webd</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">zeratul</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="o">?</span>
<span class="n">y</span><span class="o">/</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/?:</span> <span class="n">y</span>
<span class="n">Submitted</span> <span class="n">jobs</span> <span class="mi">52820</span><span class="p">,</span> <span class="mi">52821</span><span class="p">,</span> <span class="mi">52822</span><span class="p">,</span> <span class="mi">52823</span><span class="p">,</span> <span class="mi">52824</span><span class="p">,</span> <span class="mi">52825</span><span class="p">,</span> <span class="mi">52826</span><span class="p">,</span> <span class="mi">52827</span><span class="p">,</span> <span class="mi">52828</span><span class="p">,</span> <span class="mi">52829</span><span class="p">,</span> <span class="mi">52830</span>
<span class="p">[...]</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="n">job</span> <span class="mi">52825</span> <span class="p">...</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">52</span> <span class="mi">2013</span> <span class="n">Migrating</span> <span class="n">instance</span> <span class="n">crystal</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">52</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">checking</span> <span class="n">disk</span> <span class="n">consistency</span> <span class="n">between</span> <span class="n">source</span> <span class="n">and</span> <span class="n">target</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">56</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">switching</span> <span class="n">node</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">to</span> <span class="n">secondary</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">56</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">changing</span> <span class="n">into</span> <span class="n">standalone</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="mi">58</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">changing</span> <span class="n">disks</span> <span class="n">into</span> <span class="n">dual</span><span class="o">-</span><span class="n">master</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mo">01</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">resync</span> <span class="n">is</span> <span class="n">done</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mo">02</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">preparing</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">to</span> <span class="n">accept</span> <span class="n">the</span> <span class="n">instance</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mo">03</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">migrating</span> <span class="n">instance</span> <span class="n">to</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">24</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">switching</span> <span class="n">node</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">to</span> <span class="n">secondary</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">26</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">resync</span> <span class="n">is</span> <span class="n">done</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">27</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">changing</span> <span class="n">into</span> <span class="n">standalone</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">27</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">changing</span> <span class="n">disks</span> <span class="n">into</span> <span class="n">single</span><span class="o">-</span><span class="n">master</span> <span class="n">mode</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">28</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">wait</span> <span class="n">until</span> <span class="n">resync</span> <span class="n">is</span> <span class="n">done</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">28</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">done</span>
<span class="p">[...]</span>
</pre></div>


<p>Some of my instances failed to migrate properly. This seems to be related to this <a href="https://code.google.com/p/ganeti/issues/detail?id=297">bug</a>.</p>
<div class="codehilite"><pre><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">10</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">16</span> <span class="mi">2013</span> <span class="n">Migration</span> <span class="n">failed</span><span class="p">,</span> <span class="n">aborting</span>
<span class="p">[...]</span>
<span class="n">Job</span> <span class="mi">52820</span> <span class="n">has</span> <span class="n">failed</span><span class="o">:</span> <span class="n">Failure</span><span class="o">:</span> <span class="n">command</span> <span class="n">execution</span> <span class="n">error</span><span class="o">:</span>
<span class="n">Could</span> <span class="n">not</span> <span class="n">migrate</span> <span class="n">instance</span> <span class="n">sapphire</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="o">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">migrate</span> <span class="n">instance</span><span class="o">:</span> <span class="n">Too</span> <span class="n">many</span> <span class="err">&#39;</span><span class="n">info</span> <span class="n">migrate</span><span class="err">&#39;</span> <span class="n">broken</span> <span class="n">answers</span>
</pre></div>


<p>Luckly these instances were not being used at the moment and I could use gnt-instance failover.</p>
<div class="codehilite"><pre><span class="cp"># Warning! This will reboot the instance</span>
<span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">instance</span> <span class="n">failover</span> <span class="n">sapphire</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<h2>Evacuate secondaries using gnt-node</h2>
<p>After the primaries have been migrated run the gnt-node evacuate command to move the secondaries.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">node</span> <span class="n">evacuate</span> <span class="o">--</span><span class="n">secondary</span><span class="o">-</span><span class="n">only</span> <span class="n">node2</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<p>gnt-node evacuate failed with a timeout error.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">node</span> <span class="n">evacuate</span> <span class="o">--</span><span class="n">secondary</span><span class="o">-</span><span class="n">only</span> <span class="n">katana</span>
<span class="n">Relocate</span> <span class="n">instance</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">crystal</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">emerald</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span>
<span class="p">[...]</span>
<span class="n">y</span><span class="o">/</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/?:</span> <span class="n">y</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">11</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Evacuating</span> <span class="n">instances</span> <span class="n">from</span> <span class="n">node</span> <span class="err">&#39;</span><span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">crystal</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">emerald</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">fog</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">gameandwatch</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">l1011</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">log</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">marauder</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">nydus</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">panic</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">pika</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">receptacle</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">refinery</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">ruby</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">sapphire</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="kt">void</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">warpgate</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">weba</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">webb</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">webc</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">webd</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="p">,</span> <span class="n">zeratul</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="nl">Failure:</span> <span class="n">command</span> <span class="n">execution</span> <span class="n">error</span><span class="o">:</span>
<span class="n">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">get</span> <span class="n">data</span> <span class="k">for</span> <span class="n">node</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="o">:</span> <span class="n">Error</span> <span class="mi">28</span><span class="o">:</span> <span class="n">Operation</span> <span class="n">timed</span> <span class="n">out</span> <span class="n">after</span> <span class="mi">60910</span> <span class="n">milliseconds</span> <span class="n">with</span> <span class="mi">0</span> <span class="n">out</span> <span class="n">of</span> <span class="o">-</span><span class="mi">1</span> <span class="n">bytes</span> <span class="n">received</span>
</pre></div>


<p>If gnt-node evacuate fails for you can evacuate secondaries per instance.</p>
<h2>Evacuate the secondaries using gnt-instance</h2>
<p>Locate the instances you want to move.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">instance</span> <span class="n">list</span> <span class="o">-</span><span class="n">o</span> <span class="n">name</span><span class="p">,</span><span class="n">pnode</span><span class="p">,</span><span class="n">snodes</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">katana</span>

<span class="n">gameandwatch</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">l1011</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>        <span class="n">rapier</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>   <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">log</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>          <span class="n">dirk</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>     <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">marauder</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>     <span class="n">rapier</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>   <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>       <span class="n">dirk</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>     <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<p>Run gnt-instance replace-disks and give the name of another node that is not the primary of the instance.</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">instance</span> <span class="n">replace</span><span class="o">-</span><span class="n">disks</span> <span class="o">-</span><span class="n">n</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<p>The output will look similar to this:</p>
<div class="codehilite"><pre><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">39</span> <span class="mi">2013</span> <span class="n">Replacing</span> <span class="n">disk</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">39</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span> <span class="n">Check</span> <span class="n">device</span> <span class="n">existence</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">39</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Checking</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span> <span class="n">on</span> <span class="n">rapier</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Checking</span> <span class="n">volume</span> <span class="n">groups</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">2</span><span class="o">/</span><span class="mi">6</span> <span class="n">Check</span> <span class="n">peer</span> <span class="n">consistency</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Checking</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span> <span class="n">consistency</span> <span class="n">on</span> <span class="n">node</span> <span class="n">rapier</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="n">Allocate</span> <span class="n">new</span> <span class="n">storage</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Adding</span> <span class="n">new</span> <span class="n">local</span> <span class="n">storage</span> <span class="n">on</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="k">for</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">44</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">4</span><span class="o">/</span><span class="mi">6</span> <span class="n">Changing</span> <span class="n">drbd</span> <span class="n">configuration</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">44</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">activating</span> <span class="n">a</span> <span class="n">new</span> <span class="n">drbd</span> <span class="n">on</span> <span class="n">claymore</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="k">for</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">48</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Shutting</span> <span class="n">down</span> <span class="n">drbd</span> <span class="k">for</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span> <span class="n">on</span> <span class="n">old</span> <span class="n">node</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">48</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Detaching</span> <span class="n">primary</span> <span class="n">drbds</span> <span class="n">from</span> <span class="n">the</span> <span class="n">network</span> <span class="p">(</span><span class="o">=&gt;</span> <span class="n">standalone</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Updating</span> <span class="n">instance</span> <span class="n">configuration</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Attaching</span> <span class="n">primary</span> <span class="n">drbds</span> <span class="n">to</span> <span class="n">new</span> <span class="n">secondary</span> <span class="p">(</span><span class="n">standalone</span> <span class="o">=&gt;</span> <span class="n">connected</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">50</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">5</span><span class="o">/</span><span class="mi">6</span> <span class="n">Sync</span> <span class="n">devices</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">50</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Waiting</span> <span class="k">for</span> <span class="n">instance</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span> <span class="n">to</span> <span class="n">sync</span> <span class="n">disks</span><span class="p">.</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">55</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span>  <span class="mf">0.50</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">13</span><span class="n">m</span> <span class="mi">34</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">26</span><span class="o">:</span><span class="mo">00</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span>  <span class="mf">6.90</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">15</span><span class="n">m</span> <span class="mi">53</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mo">07</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">13.40</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">14</span><span class="n">m</span> <span class="mi">42</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">26</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">21.00</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">13</span><span class="n">m</span> <span class="mi">1</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">30</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">27.00</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">14</span><span class="n">m</span> <span class="mi">32</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">35</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">33.20</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">11</span><span class="n">m</span> <span class="mi">27</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">40</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">39.50</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">9</span><span class="n">m</span> <span class="mi">56</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span><span class="o">:</span><span class="mi">44</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">45.80</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">9</span><span class="n">m</span> <span class="mi">20</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span><span class="o">:</span><span class="mi">44</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">45.80</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">9</span><span class="n">m</span> <span class="mi">20</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">33</span><span class="o">:</span><span class="mi">49</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">52.10</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">8</span><span class="n">m</span> <span class="mi">2</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">34</span><span class="o">:</span><span class="mi">54</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">58.30</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">6</span><span class="n">m</span> <span class="mi">54</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">58</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">64.60</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">5</span><span class="n">m</span> <span class="mi">48</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">37</span><span class="o">:</span><span class="mo">03</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">70.90</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">4</span><span class="n">m</span> <span class="mi">52</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mi">08</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">77.20</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">3</span><span class="n">m</span> <span class="mi">50</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="mi">15</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">83.70</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">2</span><span class="n">m</span> <span class="mi">33</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span><span class="mi">20</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">90.00</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">1</span><span class="n">m</span> <span class="mi">44</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">25</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="o">-</span> <span class="n">device</span> <span class="n">disk</span><span class="o">/</span><span class="mi">0</span><span class="o">:</span> <span class="mf">96.30</span><span class="o">%</span> <span class="n">done</span><span class="p">,</span> <span class="mi">37</span><span class="n">s</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">estimated</span><span class="p">)</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="mo">04</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Instance</span> <span class="n">yermom</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">disks</span> <span class="n">are</span> <span class="n">in</span> <span class="n">sync</span><span class="p">.</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="mo">04</span> <span class="mi">2013</span> <span class="n">STEP</span> <span class="mi">6</span><span class="o">/</span><span class="mi">6</span> <span class="n">Removing</span> <span class="n">old</span> <span class="n">storage</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="mo">04</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">INFO</span><span class="o">:</span> <span class="n">Remove</span> <span class="n">logical</span> <span class="n">volumes</span> <span class="k">for</span> <span class="mi">0</span>
</pre></div>


<p>Sometimes you may get an lvm error that looks like this:</p>
<div class="codehilite"><pre><span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">18</span> <span class="mi">2013</span>  <span class="o">-</span> <span class="n">WARNING</span><span class="o">:</span> <span class="n">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">remove</span> <span class="n">old</span> <span class="n">LV</span><span class="o">:</span> <span class="n">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">lvremove</span><span class="o">:</span> <span class="n">exited</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">5</span> <span class="o">-</span>   <span class="n">Unable</span> <span class="n">to</span> <span class="n">deactivate</span> <span class="n">open</span> <span class="n">ganeti</span><span class="o">-</span><span class="mi">9</span><span class="n">bc9b089</span><span class="o">--</span><span class="mf">59f</span><span class="mi">3</span><span class="o">-</span>
<span class="o">-</span><span class="mi">4512</span><span class="o">--</span><span class="mi">9</span><span class="n">a09</span><span class="o">--</span><span class="n">e7f756caadbe</span><span class="p">.</span><span class="n">disk0_meta</span> <span class="p">(</span><span class="mi">252</span><span class="o">:</span><span class="mi">7</span><span class="p">)</span><span class="err">\</span><span class="n">n</span>  <span class="n">Unable</span> <span class="n">to</span> <span class="n">deactivate</span> <span class="n">logical</span> <span class="n">volume</span> <span class="s">&quot;9bc9b089-59f3-4512-9a09-e7f756caadbe.disk0_meta&quot;</span><span class="err">\</span><span class="n">n</span>
<span class="n">Wed</span> <span class="n">Mar</span> <span class="mi">20</span> <span class="mi">13</span><span class="o">:</span><span class="mi">15</span><span class="o">:</span><span class="mi">18</span> <span class="mi">2013</span>       <span class="n">Hint</span><span class="o">:</span> <span class="n">remove</span> <span class="n">unused</span> <span class="n">LVs</span> <span class="n">manually</span>
</pre></div>


<p>If this happens you can manually remove the old volume with the lvremove command</p>
<div class="codehilite"><pre><span class="cp"># Log into the node</span>
<span class="n">ssh</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
<span class="n">sudo</span> <span class="n">lvremove</span> <span class="mi">9</span><span class="n">bc9b089</span><span class="o">-</span><span class="mf">59f</span><span class="mi">3</span><span class="o">-</span><span class="mi">4512</span><span class="o">-</span><span class="mi">9</span><span class="n">a09</span><span class="o">-</span><span class="n">e7f756caadbe</span><span class="p">.</span><span class="n">disk0_meta</span>
</pre></div>


<h2>Mark the node offline</h2>
<p>The last step is to mark the node offline</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">gnt</span><span class="o">-</span><span class="n">node</span> <span class="n">modify</span> <span class="o">-</span><span class="n">O</span> <span class="n">yes</span> <span class="n">katana</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">pdx</span><span class="p">.</span><span class="n">edu</span>
</pre></div>


<p>gnt-cluster verify should now display that one node is offline</p>
<div class="codehilite"><pre><span class="n">gnt</span><span class="o">-</span><span class="n">cluster</span> <span class="n">verify</span> 
<span class="p">[..]</span>
<span class="n">Sat</span> <span class="n">Mar</span> <span class="mi">23</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">14</span> <span class="mi">2013</span> <span class="o">*</span> <span class="n">Other</span> <span class="n">Notes</span>
<span class="n">Sat</span> <span class="n">Mar</span> <span class="mi">23</span> <span class="mi">14</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">14</span> <span class="mi">2013</span>   <span class="o">-</span> <span class="n">NOTICE</span><span class="o">:</span> <span class="mi">1</span> <span class="n">offline</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">found</span><span class="p">.</span>
<span class="p">[..]</span>
</pre></div>


<p>And that is it, you can now take the node offline for diagnostics or to wait for new parts.</p>
<h2>Rebalance the cluster</h2>
<p>At this point you probably want to rebalance your Ganeti cluser. The following blog post by Lance Albertson does a pretty good job at explaining this process.</p>
<p><a href="http://www.lancealbertson.com/2011/05/rebalancing-ganeti-clusters/">http://www.lancealbertson.com/2011/05/rebalancing-ganeti-clusters/</a></p>                </article>
                                    <p class="paginator">
        Page 1 / 1
    </p>
                            </aside><!-- /#featured -->
                                                </ol><!-- /#posts-list -->
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="http://twitter.com/pdx_blkperl">twitter</a></li>
                                                    <li><a href="http://github.com/blkperl">github</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>